#include "types.h"
#include "spi.h"
#include "spi_cta.h"

#ifndef F_BUS
# error "F_BUS not defined"
#endif

////////////////////////////////////////////////////////////////////////////////
// Clock and Transfer Attributes
////////////////////////////////////////////////////////////////////////////////
// uint32_t sck   - frequency in Hz
// uint32_t t_csc - the delay between assertion of PCS and the first edge of SCK
// uint32_t t_asc - the delay between the last edge of SCK and negation of PCS
// uint32_t t_dt  - the time between negation of PCS and next assertion of PCS
// This function returns the relevant bits for use in the CTAR field.
uint32_t spi_cta(uint32_t sck, uint32_t t_csc, uint32_t t_asc, uint32_t t_dt)
{
    return (spi_sck(sck)
            | spi_pcs_to_sck_delay(t_csc)
            | spi_delay_after_sck(t_asc)
            | spi_delay_after_transfer(t_dt));
}

////////////////////////////////////////////////////////////////////////////////
// SCK baud rate to be used for SPI transfers.
// Given the frequency in Hz argument passed in, this function
// returns the relevant bits for use in the CTAR field.
uint32_t spi_sck(uint32_t frequency)
{
    uint32_t sck;

#if F_BUS == 48000000
    if (frequency >= 24000000)
        sck = SPI_CTAR_BR(0) | SPI_CTAR_PBR(0) | SPI_CTAR_DBR;
    else if (frequency >= 12000000)
        sck = SPI_CTAR_BR(0) | SPI_CTAR_PBR(0);
    else if (frequency >= 8000000)
        sck = SPI_CTAR_BR(0) | SPI_CTAR_PBR(1);
    else if (frequency >= 6000000)
        sck = SPI_CTAR_BR(1) | SPI_CTAR_PBR(0);
    else if (frequency >= 4800000)
        sck = SPI_CTAR_BR(0) | SPI_CTAR_PBR(2);
    else if (frequency >= 4000000)
        sck = SPI_CTAR_BR(1) | SPI_CTAR_PBR(1);
    else if (frequency >= 3428571)
        sck = SPI_CTAR_BR(0) | SPI_CTAR_PBR(3);
    else if (frequency >= 3000000)
        sck = SPI_CTAR_BR(3) | SPI_CTAR_PBR(0);
    else if (frequency >= 2666666)
        sck = SPI_CTAR_BR(2) | SPI_CTAR_PBR(1);
    else if (frequency >= 2400000)
        sck = SPI_CTAR_BR(1) | SPI_CTAR_PBR(2);
    else if (frequency >= 2000000)
        sck = SPI_CTAR_BR(3) | SPI_CTAR_PBR(1);
    else if (frequency >= 1714285)
        sck = SPI_CTAR_BR(1) | SPI_CTAR_PBR(3);
    else if (frequency >= 1600000)
        sck = SPI_CTAR_BR(2) | SPI_CTAR_PBR(2);
    else if (frequency >= 1500000)
        sck = SPI_CTAR_BR(4) | SPI_CTAR_PBR(0);
    else if (frequency >= 1200000)
        sck = SPI_CTAR_BR(3) | SPI_CTAR_PBR(2);
    else if (frequency >= 1142857)
        sck = SPI_CTAR_BR(2) | SPI_CTAR_PBR(3);
    else if (frequency >= 1000000)
        sck = SPI_CTAR_BR(4) | SPI_CTAR_PBR(1);
    else if (frequency >= 857142)
        sck = SPI_CTAR_BR(3) | SPI_CTAR_PBR(3);
    else if (frequency >= 750000)
        sck = SPI_CTAR_BR(5) | SPI_CTAR_PBR(0);
    else if (frequency >= 600000)
        sck = SPI_CTAR_BR(4) | SPI_CTAR_PBR(2);
    else if (frequency >= 500000)
        sck = SPI_CTAR_BR(5) | SPI_CTAR_PBR(1);
    else if (frequency >= 428571)
        sck = SPI_CTAR_BR(4) | SPI_CTAR_PBR(3);
    else if (frequency >= 375000)
        sck = SPI_CTAR_BR(6) | SPI_CTAR_PBR(0);
    else if (frequency >= 300000)
        sck = SPI_CTAR_BR(5) | SPI_CTAR_PBR(2);
    else if (frequency >= 250000)
        sck = SPI_CTAR_BR(6) | SPI_CTAR_PBR(1);
    else if (frequency >= 214285)
        sck = SPI_CTAR_BR(5) | SPI_CTAR_PBR(3);
    else if (frequency >= 187500)
        sck = SPI_CTAR_BR(7) | SPI_CTAR_PBR(0);
    else if (frequency >= 150000)
        sck = SPI_CTAR_BR(6) | SPI_CTAR_PBR(2);
    else if (frequency >= 125000)
        sck = SPI_CTAR_BR(7) | SPI_CTAR_PBR(1);
    else if (frequency >= 107142)
        sck = SPI_CTAR_BR(6) | SPI_CTAR_PBR(3);
    else if (frequency >= 93750)
        sck = SPI_CTAR_BR(8) | SPI_CTAR_PBR(0);
    else if (frequency >= 75000)
        sck = SPI_CTAR_BR(7) | SPI_CTAR_PBR(2);
    else if (frequency >= 62500)
        sck = SPI_CTAR_BR(8) | SPI_CTAR_PBR(1);
    else if (frequency >= 53571)
        sck = SPI_CTAR_BR(7) | SPI_CTAR_PBR(3);
    else if (frequency >= 46875)
        sck = SPI_CTAR_BR(9) | SPI_CTAR_PBR(0);
    else if (frequency >= 37500)
        sck = SPI_CTAR_BR(8) | SPI_CTAR_PBR(2);
    else if (frequency >= 31250)
        sck = SPI_CTAR_BR(9) | SPI_CTAR_PBR(1);
    else if (frequency >= 26785)
        sck = SPI_CTAR_BR(8) | SPI_CTAR_PBR(3);
    else if (frequency >= 23437)
        sck = SPI_CTAR_BR(10) | SPI_CTAR_PBR(0);
    else if (frequency >= 18750)
        sck = SPI_CTAR_BR(9) | SPI_CTAR_PBR(2);
    else if (frequency >= 15625)
        sck = SPI_CTAR_BR(10) | SPI_CTAR_PBR(1);
    else if (frequency >= 13392)
        sck = SPI_CTAR_BR(9) | SPI_CTAR_PBR(3);
    else if (frequency >= 11718)
        sck = SPI_CTAR_BR(11) | SPI_CTAR_PBR(0);
    else if (frequency >= 9375)
        sck = SPI_CTAR_BR(10) | SPI_CTAR_PBR(2);
    else if (frequency >= 7812)
        sck = SPI_CTAR_BR(11) | SPI_CTAR_PBR(1);
    else if (frequency >= 6696)
        sck = SPI_CTAR_BR(10) | SPI_CTAR_PBR(3);
    else if (frequency >= 5859)
        sck = SPI_CTAR_BR(12) | SPI_CTAR_PBR(0);
    else if (frequency >= 4687)
        sck = SPI_CTAR_BR(11) | SPI_CTAR_PBR(2);
    else if (frequency >= 3906)
        sck = SPI_CTAR_BR(12) | SPI_CTAR_PBR(1);
    else if (frequency >= 3348)
        sck = SPI_CTAR_BR(11) | SPI_CTAR_PBR(3);
    else if (frequency >= 2929)
        sck = SPI_CTAR_BR(13) | SPI_CTAR_PBR(0);
    else if (frequency >= 2343)
        sck = SPI_CTAR_BR(12) | SPI_CTAR_PBR(2);
    else if (frequency >= 1953)
        sck = SPI_CTAR_BR(13) | SPI_CTAR_PBR(1);
    else if (frequency >= 1674)
        sck = SPI_CTAR_BR(12) | SPI_CTAR_PBR(3);
    else if (frequency >= 1464)
        sck = SPI_CTAR_BR(14) | SPI_CTAR_PBR(0);
    else if (frequency >= 1171)
        sck = SPI_CTAR_BR(13) | SPI_CTAR_PBR(2);
    else if (frequency >= 976)
        sck = SPI_CTAR_BR(14) | SPI_CTAR_PBR(1);
    else if (frequency >= 837)
        sck = SPI_CTAR_BR(13) | SPI_CTAR_PBR(3);
    else if (frequency >= 732)
        sck = SPI_CTAR_BR(15) | SPI_CTAR_PBR(0);
    else if (frequency >= 585)
        sck = SPI_CTAR_BR(14) | SPI_CTAR_PBR(2);
    else if (frequency >= 488)
        sck = SPI_CTAR_BR(15) | SPI_CTAR_PBR(1);
    else if (frequency >= 418)
        sck = SPI_CTAR_BR(14) | SPI_CTAR_PBR(3);
    else if (frequency >= 292)
        sck = SPI_CTAR_BR(15) | SPI_CTAR_PBR(2);
    else
        sck = SPI_CTAR_BR(15) | SPI_CTAR_PBR(3);
#elif F_BUS == 36000000
    if (frequency >= 18000000)
        sck = SPI_CTAR_BR(0) | SPI_CTAR_PBR(0) | SPI_CTAR_DBR;
    else if (frequency >= 9000000)
        sck = SPI_CTAR_BR(0) | SPI_CTAR_PBR(0);
    else if (frequency >= 6000000)
        sck = SPI_CTAR_BR(0) | SPI_CTAR_PBR(1);
    else if (frequency >= 4500000)
        sck = SPI_CTAR_BR(1) | SPI_CTAR_PBR(0);
    else if (frequency >= 3600000)
        sck = SPI_CTAR_BR(0) | SPI_CTAR_PBR(2);
    else if (frequency >= 3000000)
        sck = SPI_CTAR_BR(1) | SPI_CTAR_PBR(1);
    else if (frequency >= 2571428)
        sck = SPI_CTAR_BR(0) | SPI_CTAR_PBR(3);
    else if (frequency >= 2250000)
        sck = SPI_CTAR_BR(3) | SPI_CTAR_PBR(0);
    else if (frequency >= 2000000)
        sck = SPI_CTAR_BR(2) | SPI_CTAR_PBR(1);
    else if (frequency >= 1800000)
        sck = SPI_CTAR_BR(1) | SPI_CTAR_PBR(2);
    else if (frequency >= 1500000)
        sck = SPI_CTAR_BR(3) | SPI_CTAR_PBR(1);
    else if (frequency >= 1285714)
        sck = SPI_CTAR_BR(1) | SPI_CTAR_PBR(3);
    else if (frequency >= 1200000)
        sck = SPI_CTAR_BR(2) | SPI_CTAR_PBR(2);
    else if (frequency >= 1125000)
        sck = SPI_CTAR_BR(4) | SPI_CTAR_PBR(0);
    else if (frequency >= 900000)
        sck = SPI_CTAR_BR(3) | SPI_CTAR_PBR(2);
    else if (frequency >= 857142)
        sck = SPI_CTAR_BR(2) | SPI_CTAR_PBR(3);
    else if (frequency >= 750000)
        sck = SPI_CTAR_BR(4) | SPI_CTAR_PBR(1);
    else if (frequency >= 642857)
        sck = SPI_CTAR_BR(3) | SPI_CTAR_PBR(3);
    else if (frequency >= 562500)
        sck = SPI_CTAR_BR(5) | SPI_CTAR_PBR(0);
    else if (frequency >= 450000)
        sck = SPI_CTAR_BR(4) | SPI_CTAR_PBR(2);
    else if (frequency >= 375000)
        sck = SPI_CTAR_BR(5) | SPI_CTAR_PBR(1);
    else if (frequency >= 321428)
        sck = SPI_CTAR_BR(4) | SPI_CTAR_PBR(3);
    else if (frequency >= 281250)
        sck = SPI_CTAR_BR(6) | SPI_CTAR_PBR(0);
    else if (frequency >= 225000)
        sck = SPI_CTAR_BR(5) | SPI_CTAR_PBR(2);
    else if (frequency >= 187500)
        sck = SPI_CTAR_BR(6) | SPI_CTAR_PBR(1);
    else if (frequency >= 160714)
        sck = SPI_CTAR_BR(5) | SPI_CTAR_PBR(3);
    else if (frequency >= 140625)
        sck = SPI_CTAR_BR(7) | SPI_CTAR_PBR(0);
    else if (frequency >= 112500)
        sck = SPI_CTAR_BR(6) | SPI_CTAR_PBR(2);
    else if (frequency >= 93750)
        sck = SPI_CTAR_BR(7) | SPI_CTAR_PBR(1);
    else if (frequency >= 80357)
        sck = SPI_CTAR_BR(6) | SPI_CTAR_PBR(3);
    else if (frequency >= 70312)
        sck = SPI_CTAR_BR(8) | SPI_CTAR_PBR(0);
    else if (frequency >= 56250)
        sck = SPI_CTAR_BR(7) | SPI_CTAR_PBR(2);
    else if (frequency >= 46875)
        sck = SPI_CTAR_BR(8) | SPI_CTAR_PBR(1);
    else if (frequency >= 40178)
        sck = SPI_CTAR_BR(7) | SPI_CTAR_PBR(3);
    else if (frequency >= 35156)
        sck = SPI_CTAR_BR(9) | SPI_CTAR_PBR(0);
    else if (frequency >= 28125)
        sck = SPI_CTAR_BR(8) | SPI_CTAR_PBR(2);
    else if (frequency >= 23437)
        sck = SPI_CTAR_BR(9) | SPI_CTAR_PBR(1);
    else if (frequency >= 20089)
        sck = SPI_CTAR_BR(8) | SPI_CTAR_PBR(3);
    else if (frequency >= 17578)
        sck = SPI_CTAR_BR(10) | SPI_CTAR_PBR(0);
    else if (frequency >= 14062)
        sck = SPI_CTAR_BR(9) | SPI_CTAR_PBR(2);
    else if (frequency >= 11718)
        sck = SPI_CTAR_BR(10) | SPI_CTAR_PBR(1);
    else if (frequency >= 10044)
        sck = SPI_CTAR_BR(9) | SPI_CTAR_PBR(3);
    else if (frequency >= 8789)
        sck = SPI_CTAR_BR(11) | SPI_CTAR_PBR(0);
    else if (frequency >= 7031)
        sck = SPI_CTAR_BR(10) | SPI_CTAR_PBR(2);
    else if (frequency >= 5859)
        sck = SPI_CTAR_BR(11) | SPI_CTAR_PBR(1);
    else if (frequency >= 5022)
        sck = SPI_CTAR_BR(10) | SPI_CTAR_PBR(3);
    else if (frequency >= 4394)
        sck = SPI_CTAR_BR(12) | SPI_CTAR_PBR(0);
    else if (frequency >= 3515)
        sck = SPI_CTAR_BR(11) | SPI_CTAR_PBR(2);
    else if (frequency >= 2929)
        sck = SPI_CTAR_BR(12) | SPI_CTAR_PBR(1);
    else if (frequency >= 2511)
        sck = SPI_CTAR_BR(11) | SPI_CTAR_PBR(3);
    else if (frequency >= 2197)
        sck = SPI_CTAR_BR(13) | SPI_CTAR_PBR(0);
    else if (frequency >= 1757)
        sck = SPI_CTAR_BR(12) | SPI_CTAR_PBR(2);
    else if (frequency >= 1464)
        sck = SPI_CTAR_BR(13) | SPI_CTAR_PBR(1);
    else if (frequency >= 1255)
        sck = SPI_CTAR_BR(12) | SPI_CTAR_PBR(3);
    else if (frequency >= 1098)
        sck = SPI_CTAR_BR(14) | SPI_CTAR_PBR(0);
    else if (frequency >= 878)
        sck = SPI_CTAR_BR(13) | SPI_CTAR_PBR(2);
    else if (frequency >= 732)
        sck = SPI_CTAR_BR(14) | SPI_CTAR_PBR(1);
    else if (frequency >= 627)
        sck = SPI_CTAR_BR(13) | SPI_CTAR_PBR(3);
    else if (frequency >= 549)
        sck = SPI_CTAR_BR(15) | SPI_CTAR_PBR(0);
    else if (frequency >= 439)
        sck = SPI_CTAR_BR(14) | SPI_CTAR_PBR(2);
    else if (frequency >= 366)
        sck = SPI_CTAR_BR(15) | SPI_CTAR_PBR(1);
    else if (frequency >= 313)
        sck = SPI_CTAR_BR(14) | SPI_CTAR_PBR(3);
    else if (frequency >= 219)
        sck = SPI_CTAR_BR(15) | SPI_CTAR_PBR(2);
    else
        sck = SPI_CTAR_BR(15) | SPI_CTAR_PBR(3);
#else
# error "F_BUS not valid"
#endif

    return sck;
}

////////////////////////////////////////////////////////////////////////////////
// This is the delay between the assertion of PCS and the first edge of SCK.
////////////////////////////////////////////////////////////////////////////////
// Given the nanosecond PCS to SCK delay argument passed in, this function
// returns the relevant bits for use in the CTAR field.
uint32_t spi_pcs_to_sck_delay(uint32_t nanoseconds)
{
    uint32_t t_csc;

#if F_BUS == 48000000
    if (nanoseconds <= 41)
        t_csc = SPI_CTAR_CSSCK(0) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 83)
        t_csc = SPI_CTAR_CSSCK(1) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 125)
        t_csc = SPI_CTAR_CSSCK(0) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 166)
        t_csc = SPI_CTAR_CSSCK(2) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 208)
        t_csc = SPI_CTAR_CSSCK(0) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 250)
        t_csc = SPI_CTAR_CSSCK(1) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 291)
        t_csc = SPI_CTAR_CSSCK(0) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 333)
        t_csc = SPI_CTAR_CSSCK(3) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 416)
        t_csc = SPI_CTAR_CSSCK(1) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 500)
        t_csc = SPI_CTAR_CSSCK(2) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 583)
        t_csc = SPI_CTAR_CSSCK(1) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 666)
        t_csc = SPI_CTAR_CSSCK(4) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 833)
        t_csc = SPI_CTAR_CSSCK(2) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 1000)
        t_csc = SPI_CTAR_CSSCK(3) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 1166)
        t_csc = SPI_CTAR_CSSCK(2) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 1333)
        t_csc = SPI_CTAR_CSSCK(5) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 1666)
        t_csc = SPI_CTAR_CSSCK(3) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 2000)
        t_csc = SPI_CTAR_CSSCK(4) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 2333)
        t_csc = SPI_CTAR_CSSCK(3) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 2666)
        t_csc = SPI_CTAR_CSSCK(6) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 3333)
        t_csc = SPI_CTAR_CSSCK(4) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 4000)
        t_csc = SPI_CTAR_CSSCK(5) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 4666)
        t_csc = SPI_CTAR_CSSCK(4) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 5333)
        t_csc = SPI_CTAR_CSSCK(7) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 6666)
        t_csc = SPI_CTAR_CSSCK(5) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 8000)
        t_csc = SPI_CTAR_CSSCK(6) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 9333)
        t_csc = SPI_CTAR_CSSCK(5) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 10666)
        t_csc = SPI_CTAR_CSSCK(8) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 13333)
        t_csc = SPI_CTAR_CSSCK(6) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 16000)
        t_csc = SPI_CTAR_CSSCK(7) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 18666)
        t_csc = SPI_CTAR_CSSCK(6) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 21333)
        t_csc = SPI_CTAR_CSSCK(9) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 26666)
        t_csc = SPI_CTAR_CSSCK(7) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 32000)
        t_csc = SPI_CTAR_CSSCK(8) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 37333)
        t_csc = SPI_CTAR_CSSCK(7) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 42666)
        t_csc = SPI_CTAR_CSSCK(10) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 53333)
        t_csc = SPI_CTAR_CSSCK(8) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 64000)
        t_csc = SPI_CTAR_CSSCK(9) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 74666)
        t_csc = SPI_CTAR_CSSCK(8) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 85333)
        t_csc = SPI_CTAR_CSSCK(11) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 106666)
        t_csc = SPI_CTAR_CSSCK(9) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 128000)
        t_csc = SPI_CTAR_CSSCK(10) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 149333)
        t_csc = SPI_CTAR_CSSCK(9) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 170666)
        t_csc = SPI_CTAR_CSSCK(12) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 213333)
        t_csc = SPI_CTAR_CSSCK(10) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 256000)
        t_csc = SPI_CTAR_CSSCK(11) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 298666)
        t_csc = SPI_CTAR_CSSCK(10) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 341333)
        t_csc = SPI_CTAR_CSSCK(13) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 426666)
        t_csc = SPI_CTAR_CSSCK(11) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 512000)
        t_csc = SPI_CTAR_CSSCK(12) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 597333)
        t_csc = SPI_CTAR_CSSCK(11) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 682666)
        t_csc = SPI_CTAR_CSSCK(14) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 853333)
        t_csc = SPI_CTAR_CSSCK(12) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 1024000)
        t_csc = SPI_CTAR_CSSCK(13) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 1194666)
        t_csc = SPI_CTAR_CSSCK(12) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 1365333)
        t_csc = SPI_CTAR_CSSCK(15) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 1706666)
        t_csc = SPI_CTAR_CSSCK(13) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 2048000)
        t_csc = SPI_CTAR_CSSCK(14) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 2389333)
        t_csc = SPI_CTAR_CSSCK(13) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 3413333)
        t_csc = SPI_CTAR_CSSCK(14) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 4096000)
        t_csc = SPI_CTAR_CSSCK(15) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 4778666)
        t_csc = SPI_CTAR_CSSCK(14) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 6826666)
        t_csc = SPI_CTAR_CSSCK(15) | SPI_CTAR_PCSSCK(2);
    else
        t_csc = SPI_CTAR_CSSCK(15) | SPI_CTAR_PCSSCK(3);
#elif F_BUS == 36000000
    if (nanoseconds <= 55)
        t_csc = SPI_CTAR_CSSCK(0) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 111)
        t_csc = SPI_CTAR_CSSCK(1) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 166)
        t_csc = SPI_CTAR_CSSCK(0) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 222)
        t_csc = SPI_CTAR_CSSCK(2) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 277)
        t_csc = SPI_CTAR_CSSCK(0) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 333)
        t_csc = SPI_CTAR_CSSCK(1) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 388)
        t_csc = SPI_CTAR_CSSCK(0) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 444)
        t_csc = SPI_CTAR_CSSCK(3) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 555)
        t_csc = SPI_CTAR_CSSCK(1) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 666)
        t_csc = SPI_CTAR_CSSCK(2) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 777)
        t_csc = SPI_CTAR_CSSCK(1) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 888)
        t_csc = SPI_CTAR_CSSCK(4) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 1111)
        t_csc = SPI_CTAR_CSSCK(2) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 1333)
        t_csc = SPI_CTAR_CSSCK(3) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 1555)
        t_csc = SPI_CTAR_CSSCK(2) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 1777)
        t_csc = SPI_CTAR_CSSCK(5) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 2222)
        t_csc = SPI_CTAR_CSSCK(3) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 2666)
        t_csc = SPI_CTAR_CSSCK(4) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 3111)
        t_csc = SPI_CTAR_CSSCK(3) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 3555)
        t_csc = SPI_CTAR_CSSCK(6) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 4444)
        t_csc = SPI_CTAR_CSSCK(4) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 5333)
        t_csc = SPI_CTAR_CSSCK(5) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 6222)
        t_csc = SPI_CTAR_CSSCK(4) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 7111)
        t_csc = SPI_CTAR_CSSCK(7) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 8888)
        t_csc = SPI_CTAR_CSSCK(5) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 10666)
        t_csc = SPI_CTAR_CSSCK(6) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 12444)
        t_csc = SPI_CTAR_CSSCK(5) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 14222)
        t_csc = SPI_CTAR_CSSCK(8) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 17777)
        t_csc = SPI_CTAR_CSSCK(6) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 21333)
        t_csc = SPI_CTAR_CSSCK(7) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 24888)
        t_csc = SPI_CTAR_CSSCK(6) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 28444)
        t_csc = SPI_CTAR_CSSCK(9) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 35555)
        t_csc = SPI_CTAR_CSSCK(7) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 42666)
        t_csc = SPI_CTAR_CSSCK(8) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 49777)
        t_csc = SPI_CTAR_CSSCK(7) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 56888)
        t_csc = SPI_CTAR_CSSCK(10) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 71111)
        t_csc = SPI_CTAR_CSSCK(8) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 85333)
        t_csc = SPI_CTAR_CSSCK(9) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 99555)
        t_csc = SPI_CTAR_CSSCK(8) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 113777)
        t_csc = SPI_CTAR_CSSCK(11) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 142222)
        t_csc = SPI_CTAR_CSSCK(9) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 170666)
        t_csc = SPI_CTAR_CSSCK(10) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 199111)
        t_csc = SPI_CTAR_CSSCK(9) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 227555)
        t_csc = SPI_CTAR_CSSCK(12) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 284444)
        t_csc = SPI_CTAR_CSSCK(10) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 341333)
        t_csc = SPI_CTAR_CSSCK(11) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 398222)
        t_csc = SPI_CTAR_CSSCK(10) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 455111)
        t_csc = SPI_CTAR_CSSCK(13) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 568888)
        t_csc = SPI_CTAR_CSSCK(11) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 682666)
        t_csc = SPI_CTAR_CSSCK(12) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 796444)
        t_csc = SPI_CTAR_CSSCK(11) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 910222)
        t_csc = SPI_CTAR_CSSCK(14) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 1137777)
        t_csc = SPI_CTAR_CSSCK(12) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 1365333)
        t_csc = SPI_CTAR_CSSCK(13) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 1592888)
        t_csc = SPI_CTAR_CSSCK(12) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 1820444)
        t_csc = SPI_CTAR_CSSCK(15) | SPI_CTAR_PCSSCK(0);
    else if (nanoseconds <= 2275555)
        t_csc = SPI_CTAR_CSSCK(13) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 2730666)
        t_csc = SPI_CTAR_CSSCK(14) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 3185777)
        t_csc = SPI_CTAR_CSSCK(13) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 4551111)
        t_csc = SPI_CTAR_CSSCK(14) | SPI_CTAR_PCSSCK(2);
    else if (nanoseconds <= 5461333)
        t_csc = SPI_CTAR_CSSCK(15) | SPI_CTAR_PCSSCK(1);
    else if (nanoseconds <= 6371555)
        t_csc = SPI_CTAR_CSSCK(14) | SPI_CTAR_PCSSCK(3);
    else if (nanoseconds <= 9102222)
        t_csc = SPI_CTAR_CSSCK(15) | SPI_CTAR_PCSSCK(2);
    else
        t_csc = SPI_CTAR_CSSCK(15) | SPI_CTAR_PCSSCK(3);
#else
# error "F_BUS not valid"
#endif

    return t_csc;
}

////////////////////////////////////////////////////////////////////////////////
// This is the delay between the last edge of SCK and the negation of PCS.
////////////////////////////////////////////////////////////////////////////////
// Given the nanosecond Delay After SCK argument passed in, this
// function returns the relevant bits for use in the CTAR field.
uint32_t spi_delay_after_sck(uint32_t nanoseconds)
{
    uint32_t t_asc;

#if F_BUS == 48000000
    if (nanoseconds <= 41)
        t_asc = SPI_CTAR_ASC(0) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 83)
        t_asc = SPI_CTAR_ASC(1) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 125)
        t_asc = SPI_CTAR_ASC(0) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 166)
        t_asc = SPI_CTAR_ASC(2) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 208)
        t_asc = SPI_CTAR_ASC(0) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 250)
        t_asc = SPI_CTAR_ASC(1) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 291)
        t_asc = SPI_CTAR_ASC(0) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 333)
        t_asc = SPI_CTAR_ASC(3) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 416)
        t_asc = SPI_CTAR_ASC(1) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 500)
        t_asc = SPI_CTAR_ASC(2) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 583)
        t_asc = SPI_CTAR_ASC(1) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 666)
        t_asc = SPI_CTAR_ASC(4) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 833)
        t_asc = SPI_CTAR_ASC(2) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 1000)
        t_asc = SPI_CTAR_ASC(3) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 1166)
        t_asc = SPI_CTAR_ASC(2) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 1333)
        t_asc = SPI_CTAR_ASC(5) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 1666)
        t_asc = SPI_CTAR_ASC(3) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 2000)
        t_asc = SPI_CTAR_ASC(4) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 2333)
        t_asc = SPI_CTAR_ASC(3) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 2666)
        t_asc = SPI_CTAR_ASC(6) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 3333)
        t_asc = SPI_CTAR_ASC(4) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 4000)
        t_asc = SPI_CTAR_ASC(5) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 4666)
        t_asc = SPI_CTAR_ASC(4) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 5333)
        t_asc = SPI_CTAR_ASC(7) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 6666)
        t_asc = SPI_CTAR_ASC(5) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 8000)
        t_asc = SPI_CTAR_ASC(6) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 9333)
        t_asc = SPI_CTAR_ASC(5) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 10666)
        t_asc = SPI_CTAR_ASC(8) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 13333)
        t_asc = SPI_CTAR_ASC(6) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 16000)
        t_asc = SPI_CTAR_ASC(7) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 18666)
        t_asc = SPI_CTAR_ASC(6) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 21333)
        t_asc = SPI_CTAR_ASC(9) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 26666)
        t_asc = SPI_CTAR_ASC(7) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 32000)
        t_asc = SPI_CTAR_ASC(8) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 37333)
        t_asc = SPI_CTAR_ASC(7) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 42666)
        t_asc = SPI_CTAR_ASC(10) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 53333)
        t_asc = SPI_CTAR_ASC(8) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 64000)
        t_asc = SPI_CTAR_ASC(9) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 74666)
        t_asc = SPI_CTAR_ASC(8) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 85333)
        t_asc = SPI_CTAR_ASC(11) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 106666)
        t_asc = SPI_CTAR_ASC(9) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 128000)
        t_asc = SPI_CTAR_ASC(10) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 149333)
        t_asc = SPI_CTAR_ASC(9) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 170666)
        t_asc = SPI_CTAR_ASC(12) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 213333)
        t_asc = SPI_CTAR_ASC(10) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 256000)
        t_asc = SPI_CTAR_ASC(11) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 298666)
        t_asc = SPI_CTAR_ASC(10) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 341333)
        t_asc = SPI_CTAR_ASC(13) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 426666)
        t_asc = SPI_CTAR_ASC(11) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 512000)
        t_asc = SPI_CTAR_ASC(12) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 597333)
        t_asc = SPI_CTAR_ASC(11) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 682666)
        t_asc = SPI_CTAR_ASC(14) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 853333)
        t_asc = SPI_CTAR_ASC(12) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 1024000)
        t_asc = SPI_CTAR_ASC(13) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 1194666)
        t_asc = SPI_CTAR_ASC(12) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 1365333)
        t_asc = SPI_CTAR_ASC(15) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 1706666)
        t_asc = SPI_CTAR_ASC(13) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 2048000)
        t_asc = SPI_CTAR_ASC(14) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 2389333)
        t_asc = SPI_CTAR_ASC(13) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 3413333)
        t_asc = SPI_CTAR_ASC(14) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 4096000)
        t_asc = SPI_CTAR_ASC(15) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 4778666)
        t_asc = SPI_CTAR_ASC(14) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 6826666)
        t_asc = SPI_CTAR_ASC(15) | SPI_CTAR_PASC(2);
    else
        t_asc = SPI_CTAR_ASC(15) | SPI_CTAR_PASC(3);
#elif F_BUS == 36000000
    if (nanoseconds <= 55)
        t_asc = SPI_CTAR_ASC(0) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 111)
        t_asc = SPI_CTAR_ASC(1) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 166)
        t_asc = SPI_CTAR_ASC(0) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 222)
        t_asc = SPI_CTAR_ASC(2) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 277)
        t_asc = SPI_CTAR_ASC(0) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 333)
        t_asc = SPI_CTAR_ASC(1) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 388)
        t_asc = SPI_CTAR_ASC(0) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 444)
        t_asc = SPI_CTAR_ASC(3) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 555)
        t_asc = SPI_CTAR_ASC(1) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 666)
        t_asc = SPI_CTAR_ASC(2) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 777)
        t_asc = SPI_CTAR_ASC(1) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 888)
        t_asc = SPI_CTAR_ASC(4) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 1111)
        t_asc = SPI_CTAR_ASC(2) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 1333)
        t_asc = SPI_CTAR_ASC(3) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 1555)
        t_asc = SPI_CTAR_ASC(2) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 1777)
        t_asc = SPI_CTAR_ASC(5) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 2222)
        t_asc = SPI_CTAR_ASC(3) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 2666)
        t_asc = SPI_CTAR_ASC(4) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 3111)
        t_asc = SPI_CTAR_ASC(3) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 3555)
        t_asc = SPI_CTAR_ASC(6) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 4444)
        t_asc = SPI_CTAR_ASC(4) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 5333)
        t_asc = SPI_CTAR_ASC(5) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 6222)
        t_asc = SPI_CTAR_ASC(4) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 7111)
        t_asc = SPI_CTAR_ASC(7) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 8888)
        t_asc = SPI_CTAR_ASC(5) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 10666)
        t_asc = SPI_CTAR_ASC(6) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 12444)
        t_asc = SPI_CTAR_ASC(5) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 14222)
        t_asc = SPI_CTAR_ASC(8) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 17777)
        t_asc = SPI_CTAR_ASC(6) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 21333)
        t_asc = SPI_CTAR_ASC(7) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 24888)
        t_asc = SPI_CTAR_ASC(6) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 28444)
        t_asc = SPI_CTAR_ASC(9) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 35555)
        t_asc = SPI_CTAR_ASC(7) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 42666)
        t_asc = SPI_CTAR_ASC(8) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 49777)
        t_asc = SPI_CTAR_ASC(7) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 56888)
        t_asc = SPI_CTAR_ASC(10) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 71111)
        t_asc = SPI_CTAR_ASC(8) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 85333)
        t_asc = SPI_CTAR_ASC(9) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 99555)
        t_asc = SPI_CTAR_ASC(8) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 113777)
        t_asc = SPI_CTAR_ASC(11) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 142222)
        t_asc = SPI_CTAR_ASC(9) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 170666)
        t_asc = SPI_CTAR_ASC(10) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 199111)
        t_asc = SPI_CTAR_ASC(9) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 227555)
        t_asc = SPI_CTAR_ASC(12) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 284444)
        t_asc = SPI_CTAR_ASC(10) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 341333)
        t_asc = SPI_CTAR_ASC(11) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 398222)
        t_asc = SPI_CTAR_ASC(10) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 455111)
        t_asc = SPI_CTAR_ASC(13) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 568888)
        t_asc = SPI_CTAR_ASC(11) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 682666)
        t_asc = SPI_CTAR_ASC(12) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 796444)
        t_asc = SPI_CTAR_ASC(11) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 910222)
        t_asc = SPI_CTAR_ASC(14) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 1137777)
        t_asc = SPI_CTAR_ASC(12) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 1365333)
        t_asc = SPI_CTAR_ASC(13) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 1592888)
        t_asc = SPI_CTAR_ASC(12) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 1820444)
        t_asc = SPI_CTAR_ASC(15) | SPI_CTAR_PASC(0);
    else if (nanoseconds <= 2275555)
        t_asc = SPI_CTAR_ASC(13) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 2730666)
        t_asc = SPI_CTAR_ASC(14) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 3185777)
        t_asc = SPI_CTAR_ASC(13) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 4551111)
        t_asc = SPI_CTAR_ASC(14) | SPI_CTAR_PASC(2);
    else if (nanoseconds <= 5461333)
        t_asc = SPI_CTAR_ASC(15) | SPI_CTAR_PASC(1);
    else if (nanoseconds <= 6371555)
        t_asc = SPI_CTAR_ASC(14) | SPI_CTAR_PASC(3);
    else if (nanoseconds <= 9102222)
        t_asc = SPI_CTAR_ASC(15) | SPI_CTAR_PASC(2);
    else
        t_asc = SPI_CTAR_ASC(15) | SPI_CTAR_PASC(3);
#else
# error "F_BUS not valid"
#endif

    return t_asc;
}

////////////////////////////////////////////////////////////////////////////////
// This is the time between the negation of the PCS signal at the end of
// a frame and the assertion of PCS at the beginning of the next frame.
////////////////////////////////////////////////////////////////////////////////
// Given the nanosecond Delay After Transfer argument passed in, this
// function returns the relevant bits for use in the CTAR field.
uint32_t spi_delay_after_transfer(uint32_t nanoseconds)
{
    uint32_t t_dt;

#if F_BUS == 48000000
    if (nanoseconds <= 41)
        t_dt = SPI_CTAR_DT(0) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 83)
        t_dt = SPI_CTAR_DT(1) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 125)
        t_dt = SPI_CTAR_DT(0) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 166)
        t_dt = SPI_CTAR_DT(2) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 208)
        t_dt = SPI_CTAR_DT(0) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 250)
        t_dt = SPI_CTAR_DT(1) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 291)
        t_dt = SPI_CTAR_DT(0) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 333)
        t_dt = SPI_CTAR_DT(3) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 416)
        t_dt = SPI_CTAR_DT(1) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 500)
        t_dt = SPI_CTAR_DT(2) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 583)
        t_dt = SPI_CTAR_DT(1) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 666)
        t_dt = SPI_CTAR_DT(4) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 833)
        t_dt = SPI_CTAR_DT(2) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 1000)
        t_dt = SPI_CTAR_DT(3) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 1166)
        t_dt = SPI_CTAR_DT(2) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 1333)
        t_dt = SPI_CTAR_DT(5) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 1666)
        t_dt = SPI_CTAR_DT(3) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 2000)
        t_dt = SPI_CTAR_DT(4) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 2333)
        t_dt = SPI_CTAR_DT(3) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 2666)
        t_dt = SPI_CTAR_DT(6) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 3333)
        t_dt = SPI_CTAR_DT(4) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 4000)
        t_dt = SPI_CTAR_DT(5) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 4666)
        t_dt = SPI_CTAR_DT(4) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 5333)
        t_dt = SPI_CTAR_DT(7) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 6666)
        t_dt = SPI_CTAR_DT(5) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 8000)
        t_dt = SPI_CTAR_DT(6) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 9333)
        t_dt = SPI_CTAR_DT(5) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 10666)
        t_dt = SPI_CTAR_DT(8) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 13333)
        t_dt = SPI_CTAR_DT(6) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 16000)
        t_dt = SPI_CTAR_DT(7) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 18666)
        t_dt = SPI_CTAR_DT(6) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 21333)
        t_dt = SPI_CTAR_DT(9) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 26666)
        t_dt = SPI_CTAR_DT(7) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 32000)
        t_dt = SPI_CTAR_DT(8) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 37333)
        t_dt = SPI_CTAR_DT(7) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 42666)
        t_dt = SPI_CTAR_DT(10) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 53333)
        t_dt = SPI_CTAR_DT(8) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 64000)
        t_dt = SPI_CTAR_DT(9) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 74666)
        t_dt = SPI_CTAR_DT(8) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 85333)
        t_dt = SPI_CTAR_DT(11) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 106666)
        t_dt = SPI_CTAR_DT(9) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 128000)
        t_dt = SPI_CTAR_DT(10) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 149333)
        t_dt = SPI_CTAR_DT(9) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 170666)
        t_dt = SPI_CTAR_DT(12) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 213333)
        t_dt = SPI_CTAR_DT(10) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 256000)
        t_dt = SPI_CTAR_DT(11) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 298666)
        t_dt = SPI_CTAR_DT(10) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 341333)
        t_dt = SPI_CTAR_DT(13) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 426666)
        t_dt = SPI_CTAR_DT(11) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 512000)
        t_dt = SPI_CTAR_DT(12) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 597333)
        t_dt = SPI_CTAR_DT(11) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 682666)
        t_dt = SPI_CTAR_DT(14) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 853333)
        t_dt = SPI_CTAR_DT(12) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 1024000)
        t_dt = SPI_CTAR_DT(13) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 1194666)
        t_dt = SPI_CTAR_DT(12) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 1365333)
        t_dt = SPI_CTAR_DT(15) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 1706666)
        t_dt = SPI_CTAR_DT(13) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 2048000)
        t_dt = SPI_CTAR_DT(14) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 2389333)
        t_dt = SPI_CTAR_DT(13) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 3413333)
        t_dt = SPI_CTAR_DT(14) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 4096000)
        t_dt = SPI_CTAR_DT(15) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 4778666)
        t_dt = SPI_CTAR_DT(14) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 6826666)
        t_dt = SPI_CTAR_DT(15) | SPI_CTAR_PDT(2);
    else
        t_dt = SPI_CTAR_DT(15) | SPI_CTAR_PDT(3);
#elif F_BUS == 36000000
    if (nanoseconds <= 55)
        t_dt = SPI_CTAR_DT(0) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 111)
        t_dt = SPI_CTAR_DT(1) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 166)
        t_dt = SPI_CTAR_DT(0) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 222)
        t_dt = SPI_CTAR_DT(2) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 277)
        t_dt = SPI_CTAR_DT(0) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 333)
        t_dt = SPI_CTAR_DT(1) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 388)
        t_dt = SPI_CTAR_DT(0) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 444)
        t_dt = SPI_CTAR_DT(3) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 555)
        t_dt = SPI_CTAR_DT(1) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 666)
        t_dt = SPI_CTAR_DT(2) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 777)
        t_dt = SPI_CTAR_DT(1) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 888)
        t_dt = SPI_CTAR_DT(4) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 1111)
        t_dt = SPI_CTAR_DT(2) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 1333)
        t_dt = SPI_CTAR_DT(3) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 1555)
        t_dt = SPI_CTAR_DT(2) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 1777)
        t_dt = SPI_CTAR_DT(5) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 2222)
        t_dt = SPI_CTAR_DT(3) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 2666)
        t_dt = SPI_CTAR_DT(4) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 3111)
        t_dt = SPI_CTAR_DT(3) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 3555)
        t_dt = SPI_CTAR_DT(6) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 4444)
        t_dt = SPI_CTAR_DT(4) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 5333)
        t_dt = SPI_CTAR_DT(5) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 6222)
        t_dt = SPI_CTAR_DT(4) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 7111)
        t_dt = SPI_CTAR_DT(7) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 8888)
        t_dt = SPI_CTAR_DT(5) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 10666)
        t_dt = SPI_CTAR_DT(6) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 12444)
        t_dt = SPI_CTAR_DT(5) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 14222)
        t_dt = SPI_CTAR_DT(8) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 17777)
        t_dt = SPI_CTAR_DT(6) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 21333)
        t_dt = SPI_CTAR_DT(7) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 24888)
        t_dt = SPI_CTAR_DT(6) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 28444)
        t_dt = SPI_CTAR_DT(9) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 35555)
        t_dt = SPI_CTAR_DT(7) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 42666)
        t_dt = SPI_CTAR_DT(8) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 49777)
        t_dt = SPI_CTAR_DT(7) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 56888)
        t_dt = SPI_CTAR_DT(10) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 71111)
        t_dt = SPI_CTAR_DT(8) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 85333)
        t_dt = SPI_CTAR_DT(9) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 99555)
        t_dt = SPI_CTAR_DT(8) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 113777)
        t_dt = SPI_CTAR_DT(11) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 142222)
        t_dt = SPI_CTAR_DT(9) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 170666)
        t_dt = SPI_CTAR_DT(10) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 199111)
        t_dt = SPI_CTAR_DT(9) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 227555)
        t_dt = SPI_CTAR_DT(12) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 284444)
        t_dt = SPI_CTAR_DT(10) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 341333)
        t_dt = SPI_CTAR_DT(11) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 398222)
        t_dt = SPI_CTAR_DT(10) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 455111)
        t_dt = SPI_CTAR_DT(13) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 568888)
        t_dt = SPI_CTAR_DT(11) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 682666)
        t_dt = SPI_CTAR_DT(12) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 796444)
        t_dt = SPI_CTAR_DT(11) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 910222)
        t_dt = SPI_CTAR_DT(14) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 1137777)
        t_dt = SPI_CTAR_DT(12) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 1365333)
        t_dt = SPI_CTAR_DT(13) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 1592888)
        t_dt = SPI_CTAR_DT(12) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 1820444)
        t_dt = SPI_CTAR_DT(15) | SPI_CTAR_PDT(0);
    else if (nanoseconds <= 2275555)
        t_dt = SPI_CTAR_DT(13) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 2730666)
        t_dt = SPI_CTAR_DT(14) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 3185777)
        t_dt = SPI_CTAR_DT(13) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 4551111)
        t_dt = SPI_CTAR_DT(14) | SPI_CTAR_PDT(2);
    else if (nanoseconds <= 5461333)
        t_dt = SPI_CTAR_DT(15) | SPI_CTAR_PDT(1);
    else if (nanoseconds <= 6371555)
        t_dt = SPI_CTAR_DT(14) | SPI_CTAR_PDT(3);
    else if (nanoseconds <= 9102222)
        t_dt = SPI_CTAR_DT(15) | SPI_CTAR_PDT(2);
    else
        t_dt = SPI_CTAR_DT(15) | SPI_CTAR_PDT(3);
#else
# error "F_BUS not valid"
#endif

    return t_dt;
}

